<?php $this->load->view('ct/common/header'); ?>
<?php !isset($PST_result['count']) ? $PST_result['count'] = 0 : $PST_result['count']; ?>
<?php !isset($SST_result['count']) ? $SST_result['count'] = 0 : $SST_result['count']; ?>
<?php !isset($PET_I_result['count']) ? $PET_I_result['count'] = 0 : $PET_I_result['count']; ?>
<?php !isset($PET_II_result['count']) ? $PET_II_result['count'] = 0 : $PET_II_result['count']; ?>
<?php !isset($assault_result['count']) ? $assault_result['count'] = 0 : $assault_result['count']; ?>
<?php !isset($saluting_result['count']) ? $saluting_result['count'] = 0 : $saluting_result['count']; ?>
<?php !isset($PLX_result['count']) ? $PLX_result['count'] = 0 : $PLX_result['count']; ?>
<?php !isset($long_cross_result['count']) ? $long_cross_result['count'] = 0 : $long_cross_result['count']; ?>
<?php !isset($mini_cross_result['count']) ? $mini_cross_result['count'] = 0 : $mini_cross_result['count']; ?>

<?php !isset($PST_result_tp['count']) ? $PST_result_tp['count'] = 0 : $PST_result_tp['count']; ?>
<?php !isset($SST_result_tp['count']) ? $SST_result_tp['count'] = 0 : $SST_result_tp['count']; ?>
<?php !isset($PET_I_result_tp['count']) ? $PET_I_result_tp['count'] = 0 : $PET_I_result_tp['count']; ?>
<?php !isset($PET_II_result_tp['count']) ? $PET_II_result_tp['count'] = 0 : $PET_II_result_tp['count']; ?>
<?php !isset($assault_result_tp['count']) ? $assault_result_tp['count'] = 0 : $assault_result_tp['count']; ?>
<?php !isset($saluting_result_tp['count']) ? $saluting_result_tp['count'] = 0 : $saluting_result_tp['count']; ?>
<?php !isset($PLX_result_tp['count']) ? $PLX_result_tp['count'] = 0 : $PLX_result_tp['count']; ?>
<?php !isset($long_cross_result_tp['count']) ? $long_cross_result_tp['count'] = 0 : $long_cross_result_tp['count']; ?>
<?php !isset($mini_cross_result_tp['count']) ? $mini_cross_result_tp['count'] = 0 : $mini_cross_result_tp['count']; ?>

<?php !isset($PST_result_t1['count']) ? $PST_result_t1['count'] = 0 : $PST_result_t1['count']; ?>
<?php !isset($SST_result_t1['count']) ? $SST_result_t1['count'] = 0 : $SST_result_t1['count']; ?>
<?php !isset($PET_I_result_t1['count']) ? $PET_I_result_t1['count'] = 0 : $PET_I_result_t1['count']; ?>
<?php !isset($PET_II_result_t1['count']) ? $PET_II_result_t1['count'] = 0 : $PET_II_result_t1['count']; ?>
<?php !isset($assault_result_t1['count']) ? $assault_result_t1['count'] = 0 : $assault_result_t1['count']; ?>
<?php !isset($saluting_result_t1['count']) ? $saluting_result_t1['count'] = 0 : $saluting_result_t1['count']; ?>
<?php !isset($PLX_result_t1['count']) ? $PLX_result_t1['count'] = 0 : $PLX_result_t1['count']; ?>
<?php !isset($long_cross_result_t1['count']) ? $long_cross_result_t1['count'] = 0 : $long_cross_result_t1['count']; ?>
<?php !isset($mini_cross_result_t1['count']) ? $mini_cross_result_t1['count'] = 0 : $mini_cross_result_t1['count']; ?>

<?php !isset($PST_result_t2['count']) ? $PST_result_t2['count'] = 0 : $PST_result_t2['count']; ?>
<?php !isset($SST_result_t2['count']) ? $SST_result_t2['count'] = 0 : $SST_result_t2['count']; ?>
<?php !isset($PET_I_result_t2['count']) ? $PET_I_result_t2['count'] = 0 : $PET_I_result_t2['count']; ?>
<?php !isset($PET_II_result_t2['count']) ? $PET_II_result_t2['count'] = 0 : $PET_II_result_t2['count']; ?>
<?php !isset($assault_result_t2['count']) ? $assault_result_t2['count'] = 0 : $assault_result_t2['count']; ?>
<?php !isset($saluting_result_t2['count']) ? $saluting_result_t2['count'] = 0 : $saluting_result_t2['count']; ?>
<?php !isset($PLX_result_t2['count']) ? $PLX_result_t2['count'] = 0 : $PLX_result_t2['count']; ?>
<?php !isset($long_cross_result_t2['count']) ? $long_cross_result_t2['count'] = 0 : $long_cross_result_t2['count']; ?>
<?php !isset($mini_cross_result_t2['count']) ? $mini_cross_result_t2['count'] = 0 : $mini_cross_result_t2['count']; ?>

<?php !isset($PST_result_t3['count']) ? $PST_result_t3['count'] = 0 : $PST_result_t3['count']; ?>
<?php !isset($SST_result_t3['count']) ? $SST_result_t3['count'] = 0 : $SST_result_t3['count']; ?>
<?php !isset($PET_I_result_t3['count']) ? $PET_I_result_t3['count'] = 0 : $PET_I_result_t3['count']; ?>
<?php !isset($PET_II_result_t3['count']) ? $PET_II_result_t3['count'] = 0 : $PET_II_result_t3['count']; ?>
<?php !isset($assault_result_t3['count']) ? $assault_result_t3['count'] = 0 : $assault_result_t3['count']; ?>
<?php !isset($saluting_result_t3['count']) ? $saluting_result_t3['count'] = 0 : $saluting_result_t3['count']; ?>
<?php !isset($PLX_result_t3['count']) ? $PLX_result_t3['count'] = 0 : $PLX_result_t3['count']; ?>
<?php !isset($long_cross_result_t3['count']) ? $long_cross_result_t3['count'] = 0 : $long_cross_result_t3['count']; ?>
<?php !isset($mini_cross_result_t3['count']) ? $mini_cross_result_t3['count'] = 0 : $mini_cross_result_t3['count']; ?>
<?php !isset($division_set) ? $division_set = "ooo" : $division_set; ?>


<div class="container-fluid my-4">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-black-800"><strong>PHYSICAL MILESTONE GRAPHS</strong></h1>
        <!-- <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" data-toggle="modal" data-target="#all_projects"><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a> -->
    </div>
    <!-- Content Row -->
    <div class="row" style="height:20px">
        <input type="text" class="form-control form-control-user" name="div_passed" id="div_passed" value="<?= $division_set; ?>" style="display:none">
    </div>

    <div class="row">
        <div class="col-sm-3 mb-1">
            <a id="overall" href="#" class="btn btn-md btn-primary shadow-md rounded-pill" style="border-radius:20px;width:100%; height:100%"><i class="fas fa-globe fa-md text-white-60"></i> OVERALL MILESTONES GRAPH</a>
        </div>
        <div class="col-sm-3 mb-1">
            <a id="termwise" href="#" class="btn btn-md btn-primary shadow-md rounded-pill" style="border-radius:20px;width:100%;height:100%"><i class="fas fa-align-justify fa-md text-white-60"></i> TERMWISE MILE STONES GRAPH</a>
        </div>
        <div class="col-sm-3 mb-1">
            <a id="divisionwise" href="#" class="btn btn-md btn-primary shadow-md rounded-pill" style="border-radius:20px;width:100%;height:100%"><i class="fas fa-layer-group fa-md text-white-60"></i> DIVISION WISE MILESTONES GRAPH</a>
        </div>
        <div class="col-sm-3 mb-1">
            <select id="div_select" class="form-control rounded-pill" name="div" id="div" data-placeholder="Select ship" style="font-size: 0.8rem; height:100%; display:none">
                <option class="form-control form-control-user" value="">SELECT DIVISION</option>
                <?php foreach ($divisions as $data) { ?>
                    <option class="form-control form-control-user" value="<?= $data['division_name'] ?>"><?= $data['division_name'] ?></option>
                <?php } ?>
            </select>
        </div>
    </div>

    <div class="card-body bg-custom3" id="overall_graph" style="display:none">
        <div class="form-group row" style="margin-top:50px;">
            <div class="col-sm-12">
                <div id="chartContainer2" style="height: 370px; width: 100%;"></div>
            </div>
        </div>
    </div>

    <div class="card-body bg-custom3" id="termwise_graph" style="display:none">
        <div class="form-group row" style="margin-top:50px;">
            <div class="col-sm-6">
                <div id="chartContainer_tp" style="height: 370px; width: 100%;"></div>
            </div>
            <div class="col-sm-6">
                <div id="chartContainer_t1" style="height: 370px; width: 100%;"></div>
            </div>
        </div>
        <div class="form-group row" style="margin-top:50px;">
            <div class="col-sm-6">
                <div id="chartContainer_t2" style="height: 370px; width: 100%;"></div>
            </div>
            <div class="col-sm-6">
                <div id="chartContainer_t3" style="height: 370px; width: 100%;"></div>
            </div>
        </div>
    </div>

    <?php
    if (!isset($Total_cadet_tp['count']) || $Total_cadet_tp['count'] == 0) {
        $Total_cadet_tp['count'] = 1;
    }
    if (!isset($Total_cadet_t1['count']) || $Total_cadet_t1['count'] == 0) {
        $Total_cadet_t1['count'] = 1;
    }
    if (!isset($Total_cadet_t2['count']) || $Total_cadet_t2['count'] == 0) {
        $Total_cadet_t2['count'] = 1;
    }
    if (!isset($Total_cadet_t3['count']) || $Total_cadet_t3['count'] == 0) {
        $Total_cadet_t3['count'] = 1;
    }
    if (!isset($Total_cadet['count']) || $Total_cadet['count'] == 0) {
        $Total_cadet['count'] = 1;
    }
    

    $dataPoints2 = array(
        array("label" => "PST QUALIFIED ", "y" => ($PST_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "SST QUALIFIED", "y" => ($SST_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "PET-I QUALIFIED", "y" => ($PET_I_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "PET-II QUALIFIED", "y" => ($PET_II_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "PET-III QUALIFIED", "y" => ($assault_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "PET-IV QUALIFIED", "y" => ($saluting_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "PET-V QUALIFIED", "y" => ($PLX_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "PET-VI  QUALIFIED", "y" => ($long_cross_result['count'] / $Total_cadet['count']) * 100),
        array("label" => "PARADE TRAINING QUALIFIED", "y" => ($mini_cross_result['count'] / $Total_cadet['count']) * 100)
    );

    $dataPoints_tp = array(
        array("label" => "PST", "y" => ($PST_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "SST", "y" => ($SST_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "PET-I", "y" => ($PET_I_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "PET-II", "y" => ($PET_II_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "PET-III", "y" => ($assault_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "PET-IV", "y" => ($saluting_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "PET-V", "y" => ($PLX_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "PET-VI", "y" => ($long_cross_result_tp['count'] / $Total_cadet_tp['count']) * 100),
        array("label" => "PARADE TRAINIG", "y" => ($mini_cross_result_tp['count'] / $Total_cadet_tp['count']) * 100)
    );
    
    $dataPoints_t1 = array(
        array("label" => "PST", "y" => ($PST_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "SST", "y" => ($SST_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "PET-I", "y" => ($PET_I_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "PET-II", "y" => ($PET_II_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "PET-III", "y" => ($assault_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "PET-IV", "y" => ($saluting_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "PET-V", "y" => ($PLX_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "PET-VI ", "y" => ($long_cross_result_t1['count'] / $Total_cadet_t1['count']) * 100),
        array("label" => "PARADE TRAINING ", "y" => ($mini_cross_result_t1['count'] / $Total_cadet_t1['count']) * 100)
    );
    $dataPoints_t2 = array(
        array("label" => "PST", "y" => ($PST_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "SST", "y" => ($SST_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "PET-I", "y" => ($PET_I_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "PET-II", "y" => ($PET_II_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "PET-III", "y" => ($assault_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "PET-IV", "y" => ($saluting_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "PET-V", "y" => ($PLX_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "PET-VI ", "y" => ($long_cross_result_t2['count'] / $Total_cadet_t2['count']) * 100),
        array("label" => "PARADE TRAINING ", "y" => ($mini_cross_result_t2['count'] / $Total_cadet_t2['count']) * 100)
    );
    $dataPoints_t3 = array(
        array("label" => "PST", "y" => ($PST_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "SST", "y" => ($SST_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "PET-I", "y" => ($PET_I_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "PET-II", "y" => ($PET_II_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "PET-III", "y" => ($assault_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "PET-IV", "y" => ($saluting_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "PET-V", "y" => ($PLX_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "PET-VI ", "y" => ($long_cross_result_t3['count'] / $Total_cadet_t3['count']) * 100),
        array("label" => "PARADE TRAINING ", "y" => ($mini_cross_result_t3['count'] / $Total_cadet_t3['count']) * 100)
    );
    ?>
</div>

</div>

<?php $this->load->view('common/footer'); ?>
<script>
    window.onload = function() {
        var division = $('#div_passed').val();

        if (division != "ooo" && division != 'Overall' && division != 'termwise') {
            setTimeout(function() {

                var chart1 = new CanvasJS.Chart("chartContainer2", {
                    animationEnabled: true,
                    theme: "light2", // "light1", "light2", "dark1", "dark2"
                    title: {
                        text: division + " - UTs PHYSICAL MILESTONES ANALYTICS"
                    },
                    subtitles: [{
                        text: "PERCENTAGE (%)"
                    }],
                    axisY: {
                        title: "AGGREGATE",
                        maximum: 100,
                    },
                    data: [{
                        type: "column",
                        showInLegend: true,
                        legendMarkerColor: "grey",
                        legendText: "TOTAL AGGREGATE",
                        dataPoints: <?php echo json_encode($dataPoints2, JSON_NUMERIC_CHECK); ?>
                    }]
                });
                chart1.render();

            }, 1000);

            $('#overall_graph').show();

        } else if (division == 'Overall') {
            setTimeout(function() {
                var chart1 = new CanvasJS.Chart("chartContainer2", {
                    animationEnabled: true,
                    theme: "light2", // "light1", "light2", "dark1", "dark2"
                    title: {
                        text: "OVERALL UTs PHYSICAL MILESTONE GRAPH"
                    },
                    subtitles: [{
                        text: "PERCENTAGE (%)"
                    }],
                    axisY: {
                        title: "AGGREGATE",
                        maximum: 100,
                    },
                    data: [{
                        type: "column",
                        showInLegend: true,
                        legendMarkerColor: "grey",
                        legendText: "TOTAL AGGREGATE",
                        dataPoints: <?php echo json_encode($dataPoints2, JSON_NUMERIC_CHECK); ?>
                    }]
                });
                chart1.render();

            }, 1000);

        } else if (division == 'termwise') {
            setTimeout(function() {
                var chartp = new CanvasJS.Chart("chartContainer_tp", {
                    animationEnabled: true,
                    theme: "light2", // "light1", "light2", "dark1", "dark2"
                    title: {
                        text: "TERM-I"
                    },
                    subtitles: [{
                        text: "PERCENTAGE (%)"
                    }],
                    axisY: {
                        title: "AGGREGATE",
                        maximum: 100,
                    },
                    data: [{
                        type: "column",
                        showInLegend: true,
                        legendMarkerColor: "grey",
                        legendText: "TOTAL AGGREGATE",
                        dataPoints: <?php echo json_encode($dataPoints_tp, JSON_NUMERIC_CHECK); ?>
                    }]
                });
                chartp.render();

                var chart2 = new CanvasJS.Chart("chartContainer_t1", {
                    animationEnabled: true,
                    theme: "light2", // "light1", "light2", "dark1", "dark2"
                    title: {
                        text: "TERM-II"
                    },
                    subtitles: [{
                        text: "PERCENTAGE (%)"
                    }],
                    axisY: {
                        title: "AGGREGATE",
                        maximum: 100,
                    },
                    data: [{
                        type: "column",
                        showInLegend: true,
                        legendMarkerColor: "grey",
                        legendText: "TOTAL AGGREGATE",
                        dataPoints: <?php echo json_encode($dataPoints_t1, JSON_NUMERIC_CHECK); ?>
                    }]
                });
                chart2.render();

                var chart3 = new CanvasJS.Chart("chartContainer_t2", {
                    animationEnabled: true,
                    theme: "light2", // "light1", "light2", "dark1", "dark2"
                    title: {
                        text: "TERM-III"
                    },
                    subtitles: [{
                        text: "PERCENTAGE (%)"
                    }],
                    axisY: {
                        title: "AGGREGATE",
                        maximum: 100,
                    },
                    data: [{
                        type: "column",
                        showInLegend: true,
                        legendMarkerColor: "grey",
                        legendText: "TOTAL AGGREGATE",
                        dataPoints: <?php echo json_encode($dataPoints_t2, JSON_NUMERIC_CHECK); ?>
                    }]
                });
                chart3.render();

                var chart4 = new CanvasJS.Chart("chartContainer_t3", {
                    animationEnabled: true,
                    theme: "light2", // "light1", "light2", "dark1", "dark2"
                    title: {
                        text: "TERM-IV"
                    },
                    subtitles: [{
                        text: "PERCENTAGE (%)"
                    }],
                    axisY: {
                        title: "AGGREGATE",
                        maximum: 100,
                    },
                    data: [{
                        type: "column",
                        showInLegend: true,
                        legendMarkerColor: "grey",
                        legendText: "TOTAL AGGREGATE",
                        dataPoints: <?php echo json_encode($dataPoints_t3, JSON_NUMERIC_CHECK); ?>
                    }]
                });
                chart4.render();
            }, 1000);
        } else {
            $('#overall_graph').hide();
        }
    }

    $('#overall').on('click', function() {

        $.ajax({
            url: '<?= base_url(); ?>CT/get_graph_overall',
            method: 'POST',
            data: {
                'type': 'OVERALL'
            },
            success: function(data) {
                var newDoc = document.open("text/html", "replace");
                newDoc.write(data);
                newDoc.close();
            },
            async: false,

        });

        $('#overall_graph').show();
        $('#termwise_graph').hide();
    });

    $('#termwise').on('click', function() {

        $.ajax({
            url: '<?= base_url(); ?>CT/get_graph_termwise',
            method: 'POST',
            data: {
                'type': 'TERMWISE'
            },
            success: function(data) {
                var newDoc = document.open("text/html", "replace");
                newDoc.write(data);
                newDoc.close();
            },
            async: false,

        });

        $('#termwise_graph').show();
        $('#overall_graph').hide();
    });

    $('#divisionwise').on('click', function() {
        $('#div_select').show();
        $('#termwise_graph').hide();
        $('#overall_graph').hide();
    });

    $('#div_select').on('change', function() {
        var selectedValue = $(this).val();
        // alert(selectedValue);
        $.ajax({
            url: '<?= base_url(); ?>CT/get_graph_divisionwise',
            method: 'POST',
            data: {
                'selected_division': selectedValue
            },
            success: function(data) {
                var newDoc = document.open("text/html", "replace");
                newDoc.write(data);
                newDoc.close();
            },
            async: false,

        });
    });


    function seen(data) {
        $.ajax({
            url: '<?= base_url(); ?>ChatController/seen',
            method: 'POST',
            data: {
                'id': data
            },
            success: function(data) {
                $('#notification').html(data);
            },
            async: true
        });
    }

    $('#notifications').focusout(function() {
        // alert('notification clicked');
        $.ajax({
            url: '<?= base_url(); ?>ChatController/activity_seen',
            success: function(data) {
                $('#notifications').html(data);
            },
            async: true
        });
    });
</script>